import { useState, useMemo } from "react";

const PORT=[
  {n:"TIGER ë¯¸êµ­ë°°ë‹¹ë‹¤ìš°ì¡´ìŠ¤",c:"458730",w:20,d:3.5,cy:"ë¶„ê¸°",mo:[3,6,9,12],p:10500},
  {n:"KODEX ë¯¸êµ­ë°°ë‹¹ì»¤ë²„ë“œì½œ",c:"443870",w:15,d:7.0,cy:"ì›”",mo:[1,2,3,4,5,6,7,8,9,10,11,12],p:10200},
  {n:"ACE ë¯¸êµ­ë°°ë‹¹í€„ë¦¬í‹°",c:"433850",w:10,d:3.2,cy:"ë¶„ê¸°",mo:[3,6,9,12],p:10300},
  {n:"TIGER ì€í–‰ê³ ë°°ë‹¹TOP10",c:"448290",w:15,d:5.5,cy:"ë¶„ê¸°",mo:[1,4,7,10],p:11800},
  {n:"TIGER ì½”ë¦¬ì•„ë°°ë‹¹ë‹¤ìš°ì¡´ìŠ¤",c:"0052D0",w:10,d:4.5,cy:"ì›”",mo:[1,2,3,4,5,6,7,8,9,10,11,12],p:16700},
  {n:"KODEX ì¢…í•©ì±„ê¶Œì•¡í‹°ë¸Œ",c:"453810",w:15,d:3.5,cy:"ì›”",mo:[1,2,3,4,5,6,7,8,9,10,11,12],p:52000},
  {n:"TIGER ë¯¸êµ­S&P500",c:"360750",w:10,d:1.5,cy:"ë¶„ê¸°",mo:[1,4,7,10],p:18500},
  {n:"ACE KRXê¸ˆí˜„ë¬¼",c:"411060",w:5,d:0.0,cy:"-",mo:[],p:19800},
];
const BK=[{name:"í•œêµ­íˆ¬ìì¦ê¶Œ",amt:8300,per:"64-66ì„¸"},{name:"ë¯¸ë˜ì—ì…‹ì¦ê¶Œ",amt:39000,per:"66-74ì„¸"},{name:"ì‚¼ì„±ì¦ê¶Œ",amt:41800,per:"61-100ì„¸"}];
const MN=["1ì›”","2ì›”","3ì›”","4ì›”","5ì›”","6ì›”","7ì›”","8ì›”","9ì›”","10ì›”","11ì›”","12ì›”"];
const f=n=>n===0?"0":n>=10000?(n/10000).toFixed(1)+"ì–µ":n.toLocaleString();
const fw=n=>n.toLocaleString();
const pN=a=>a<=64?"ì´ˆê¸°":a===65?"ìµœëŒ€":a<=74?"í™©ê¸ˆê¸°":a<=80?"ì„±ìˆ™ê¸°":a<=89?"ì•ˆì •ê¸°":"ì¥ìˆ˜ê¸°";
const pC=a=>a<=64?"#3b82f6":a<=65?"#10b981":a<=74?"#059669":a<=80?"#d97706":a<=89?"#8b5cf6":"#6b7280";

function calcSchedule(total,rate,divRate,taxRate,m61,m65,m90){
  const adr=divRate*(1-taxRate/100);const rows=[];let bal=total;
  for(let i=0;i<40;i++){const age=61+i,yr=2027+i;
    if(bal<=0){rows.push({yr,age,div:0,sell:0,mw:0,ret:0,sb:0,eb:0});continue;}
    let mw=age<=64?m61:age===65?m65:age<=89?Math.round(m65-(age-65)*(m65-m90)/25):m90;
    const div=Math.round(bal*adr/100/12),sell=Math.max(0,mw-div),ret=Math.round(bal*rate/100),eb=Math.max(0,bal+ret-mw*12);
    rows.push({yr,age,div,sell,mw,ret,sb:bal,eb});bal=eb;}return rows;}

function findOptimalM65(total,rate,divRate,taxRate,m61,m90){
  if(total<=0)return m90;let lo=m90,hi=Math.max(m90+1,Math.round(total/12));
  for(let i=0;i<200;i++){const mid=Math.round((lo+hi)/2);const rows=calcSchedule(total,rate,divRate,taxRate,m61,mid,m90);
    const fb=rows[39].eb,dep=rows.find(r=>r.eb===0&&r.sb>0);
    if(dep&&dep.age<100)hi=mid-1;else if(fb>500)lo=mid+1;else hi=mid;if(hi<=lo)break;}return lo;}

function getStats(rows){const last=rows[39],totalW=rows.reduce((s,r)=>s+r.mw*12,0),totalR=rows.reduce((s,r)=>s+r.ret,0),totalD=rows.reduce((s,r)=>s+r.div*12,0),avgM=Math.round(rows.reduce((s,r)=>s+r.mw,0)/40),depRow=rows.find(r=>r.eb===0&&r.sb>0),depAge=depRow?depRow.age:null;return{last,totalW,totalR,totalD,avgM,depAge};}

const Stat=({label,value,unit="",color="#1e40af",big=false})=>(<div className="flex flex-col items-center justify-center p-3 rounded-xl bg-white shadow" style={{border:`2px solid ${color}22`}}><div className="text-gray-500" style={{fontSize:10,fontWeight:600}}>{label}</div><div style={{fontSize:big?30:22,fontWeight:900,color,letterSpacing:"-0.5px",lineHeight:1.1,marginTop:2}}>{value}</div>{unit&&<div style={{fontSize:10,color:"#9ca3af",marginTop:1}}>{unit}</div>}</div>);

const NI=({label,value,onChange,suffix="",note=""})=>(<div className="flex flex-col" style={{gap:2}}><div className="text-gray-500" style={{fontSize:10,fontWeight:600}}>{label}</div><div className="flex items-center" style={{gap:4}}><input type="number" value={value} onChange={e=>onChange(+e.target.value)} className="w-full px-3 py-2 rounded-lg outline-none" style={{border:"2px solid #fbbf24",background:"#fefce8",textAlign:"right",fontSize:18,fontWeight:800,color:"#1e40af"}}/>{suffix&&<span style={{fontSize:11,color:"#6b7280",whiteSpace:"nowrap"}}>{suffix}</span>}</div>{note&&<div style={{fontSize:9,color:"#9ca3af"}}>{note}</div>}</div>);

const BalChart=({rows,depAge,uid="c"})=>{const maxBal=Math.max(...rows.map(r=>r.sb),1),W=700,H=110;const pts=rows.map((r,i)=>({x:45+(i/39)*(W-65),y:12+(H-24)*(1-r.sb/maxBal)}));const line=pts.map((p,i)=>`${i===0?"M":"L"}${p.x},${p.y}`).join("");const di=depAge?depAge-61:null;const gid="gd_"+uid;
  return(<div className="rounded-xl bg-white p-3 shadow" style={{border:"1px solid #e5e7eb"}}><svg width={W} height={H} viewBox={`0 0 ${W} ${H}`} className="w-full"><defs><linearGradient id={gid} x1="0" y1="0" x2="0" y2="1"><stop offset="0%" stopColor="#3b82f6" stopOpacity="0.25"/><stop offset="100%" stopColor="#3b82f6" stopOpacity="0.02"/></linearGradient></defs><path d={line+` L${pts[39].x},${H-8} L${pts[0].x},${H-8} Z`} fill={`url(#${gid})`}/><path d={line} fill="none" stroke="#2563eb" strokeWidth="2.5"/>{di!=null&&di<40&&<line x1={pts[di].x} y1={5} x2={pts[di].x} y2={H-5} stroke="#dc2626" strokeWidth="2" strokeDasharray="4,3"/>}{[0,5,10,15,20,25,30,35,39].map(i=><g key={i}><circle cx={pts[i].x} cy={pts[i].y} r="3.5" fill={rows[i].sb===0?"#dc2626":"#2563eb"}/><text x={pts[i].x} y={H-1} textAnchor="middle" fontSize="8" fill="#9ca3af">{61+i}ì„¸</text>{rows[i].sb>0&&<text x={pts[i].x} y={pts[i].y-7} textAnchor="middle" fontSize="8" fontWeight="700" fill="#1e40af">{f(rows[i].sb)}</text>}</g>)}{di!=null&&di<40&&<text x={pts[di].x} y="14" textAnchor="middle" fontSize="10" fontWeight="800" fill="#dc2626">{depAge}ì„¸ ì†Œì§„</text>}</svg></div>);};

const CfTable=({rows,hBg="#1e293b",maxH=450})=>(<div className="overflow-auto rounded-xl" style={{border:"1px solid #e5e7eb",maxHeight:maxH}}><table className="w-full" style={{fontSize:11}}><thead className="sticky top-0 z-10"><tr style={{background:hBg,color:"#fff"}}>{["ì—°ë„","ì—°ë ¹","êµ¬ê°„","ì„¸í›„ë°°ë‹¹","ì£¼ì‹ë§¤ë„","ì›”ì¸ì¶œì•¡","íˆ¬ììˆ˜ìµ","ê¸°ì´ˆì”ê³ ","ê¸°ë§ì”ê³ "].map((h,i)=><th key={i} className="px-2 py-2 text-center" style={{fontSize:9,fontWeight:700}}>{h}</th>)}</tr></thead><tbody>{rows.map((r,i)=>(<tr key={i} style={{background:r.sb===0?"#fef2f2":r.eb===0&&r.sb>0?"#fef3c7":i%2?"#f8fafc":"#fff",borderBottom:"1px solid #f1f5f9"}}><td className="px-1 py-1 text-center text-gray-400" style={{fontSize:10}}>{r.yr}</td><td className="px-1 py-1 text-center" style={{fontSize:15,fontWeight:800}}>{r.age}</td><td className="px-1 py-1 text-center"><span className="px-1.5 py-0.5 rounded-full text-white" style={{fontSize:8,fontWeight:700,background:pC(r.age)}}>{pN(r.age)}</span></td><td className="px-1 py-1 text-right" style={{fontSize:14,fontWeight:700,color:"#0d9488"}}>{fw(r.div)}</td><td className="px-1 py-1 text-right" style={{fontSize:13,fontWeight:600}}>{fw(r.sell)}</td><td className="px-1 py-1 text-right" style={{fontSize:17,fontWeight:900,color:"#1e40af"}}>{fw(r.mw)}</td><td className="px-1 py-1 text-right" style={{fontSize:13,fontWeight:600,color:"#059669"}}>{fw(r.ret)}</td><td className="px-1 py-1 text-right" style={{fontSize:13,fontWeight:700}}>{f(r.sb)}</td><td className="px-1 py-1 text-right" style={{fontSize:15,fontWeight:800,color:r.eb===0&&r.sb>0?"#dc2626":r.eb===0?"#9ca3af":"#111"}}>{f(r.eb)}</td></tr>))}</tbody></table></div>);

/* â•â•â• TAB 1: ì¸ì¶œ ì‹œë®¬ë ˆì´í„° â•â•â• */
function Tab1(){
  const [total,setTotal]=useState(89100);const [rate,setRate]=useState(5.5);const [divRate,setDivRate]=useState(4.5);const [taxRate,setTaxRate]=useState(15.4);
  const [m61,setM61]=useState(200);const [m90,setM90]=useState(200);
  const autoM65=useMemo(()=>findOptimalM65(total,rate,divRate,taxRate,m61,m90),[total,rate,divRate,taxRate,m61,m90]);
  const rows=useMemo(()=>calcSchedule(total,rate,divRate,taxRate,m61,autoM65,m90),[total,rate,divRate,taxRate,m61,autoM65,m90]);
  const st=useMemo(()=>getStats(rows),[rows]);
  return(<div className="flex flex-col gap-4">
    <div className="p-4 rounded-xl" style={{background:"linear-gradient(135deg,#065f46,#059669)"}}><div style={{fontSize:15,fontWeight:900,color:"#fff"}}>ğŸ“Š IRP ì—°ê¸ˆ ì¸ì¶œ ì‹œë®¬ë ˆì´í„°</div><div style={{fontSize:10,color:"#a7f3d0"}}>IRP ê¸ˆì•¡ ì…ë ¥ â†’ 65ì„¸ ìµœëŒ€ ì¸ì¶œì•¡ ìë™ ìµœì í™” â†’ 100ì„¸ 0ì› ìˆ˜ë ´</div></div>
    <div className="p-4 rounded-xl" style={{background:"linear-gradient(135deg,#ecfdf5,#d1fae5)",border:"2px solid #10b981"}}>
      <div className="flex items-center gap-2 mb-3"><span className="flex items-center justify-center rounded-full text-white" style={{width:24,height:24,background:"#059669",fontSize:12,fontWeight:900}}>1</span><span style={{fontSize:12,fontWeight:800,color:"#065f46"}}>ê¸°ë³¸ ì„¤ì •</span></div>
      <div className="grid grid-cols-4 gap-3"><NI label="IRP ì´ìì‚°(ë§Œì›)" value={total} onChange={setTotal} note={f(total)+"ì›"}/><NI label="ì˜ˆìƒ ìˆ˜ìµë¥ (%)" value={rate} onChange={setRate}/><NI label="í‰ê·  ë°°ë‹¹ë¥ (%)" value={divRate} onChange={setDivRate}/><NI label="ë°°ë‹¹ ì„¸ìœ¨(%)" value={taxRate} onChange={setTaxRate}/></div></div>
    <div className="p-4 rounded-xl" style={{background:"linear-gradient(135deg,#fef3c7,#fefce8)",border:"2px solid #f59e0b"}}>
      <div className="flex items-center gap-2 mb-3"><span className="flex items-center justify-center rounded-full text-white" style={{width:24,height:24,background:"#d97706",fontSize:12,fontWeight:900}}>2</span><span style={{fontSize:12,fontWeight:800,color:"#92400e"}}>ì—°ë ¹ë³„ ì¸ì¶œì•¡ (ìë™ ìµœì í™”)</span><span style={{fontSize:10,color:"#d97706",background:"#fff7ed",padding:"2px 8px",borderRadius:12,fontWeight:700,marginLeft:4}}>ğŸ¯ ìë™ê³„ì‚°</span></div>
      <div className="grid grid-cols-3 gap-4">
        <NI label="61-64ì„¸ ê³ ì •" value={m61} onChange={setM61} suffix="ë§Œ/ì›”"/>
        <div className="p-3 rounded-xl bg-white shadow-sm text-center" style={{border:"2px solid #f59e0b"}}><div style={{fontSize:10,color:"#d97706",fontWeight:700}}>65ì„¸ ìµœëŒ€ (ìë™ê³„ì‚°)</div><div style={{fontSize:36,fontWeight:900,color:"#d97706"}}>{fw(autoM65)}<span style={{fontSize:13,color:"#9ca3af"}}>ë§Œ/ì›”</span></div><div style={{fontSize:9,color:"#9ca3af"}}>66~89ì„¸ ê· ë“±ê°ì†Œ â†’ 89ì„¸ {fw(Math.round(autoM65-(89-65)*(autoM65-m90)/25))}ë§Œ</div></div>
        <NI label="90-100ì„¸ ê³ ì •" value={m90} onChange={setM90} suffix="ë§Œ/ì›”"/></div></div>
    <div className="grid grid-cols-5 gap-3"><Stat label="ì›”í‰ê·  ì¸ì¶œ" value={fw(st.avgM)} unit="ë§Œì›/ì›”" color="#1e40af" big/><Stat label="ì´ì¸ì¶œ(40ë…„)" value={f(st.totalW)} unit="ì›" color="#1e40af"/><Stat label="ì´íˆ¬ììˆ˜ìµ" value={f(st.totalR)} unit="ì›" color="#059669"/><Stat label="100ì„¸ ì”ì•¡" value={fw(st.last.eb)} unit={st.last.eb<=500?"âœ… 0ì›ìˆ˜ë ´":"ì”ì—¬"} color={st.last.eb<=500?"#059669":"#d97706"} big/><Stat label="ë°°ë‹¹ì´ì•¡" value={f(st.totalD)} unit="ì›" color="#0d9488"/></div>
    <BalChart rows={rows} depAge={st.depAge} uid="t1"/><CfTable rows={rows}/></div>);}

/* â•â•â• TAB 2 â•â•â• */
function Tab2(){const [total,setTotal]=useState(89100);const [prices,setPrices]=useState(Object.fromEntries(PORT.map(p=>[p.c,p.p])));
  const alloc=useMemo(()=>PORT.map(p=>{const amt=Math.round(total*p.w/100),sh=Math.floor(amt*10000/prices[p.c]),act=Math.round(sh*prices[p.c]/10000);return{...p,amt,sh,act,adv:Math.round(act*p.d/100)};}),[total,prices]);
  const totAdv=alloc.reduce((s,a)=>s+a.adv,0),totAct=alloc.reduce((s,a)=>s+a.act,0);
  return(<div className="flex flex-col gap-3">
    <div className="grid grid-cols-2 gap-3"><NI label="IRP ì´ê¸ˆì•¡(ë§Œ)" value={total} onChange={setTotal} note={f(total)+"ì›"}/><div className="grid grid-cols-3 gap-2"><Stat label="ì›”ë°°ë‹¹" value={fw(Math.round(totAdv/12))} unit="ë§Œ/ì›”" color="#059669" big/><Stat label="ì—°ë°°ë‹¹" value={fw(totAdv)} unit="ë§Œ/ë…„" color="#059669"/><Stat label="ë°°ë‹¹ë¥ " value={(totAct>0?(totAdv/totAct*100).toFixed(1):0)+"%"} color="#0d9488"/></div></div>
    <div className="overflow-auto rounded-xl" style={{border:"1px solid #e5e7eb"}}><table className="w-full" style={{fontSize:11}}><thead><tr style={{background:"#1e293b",color:"#fff"}}>{["#","ì¢…ëª©ëª…","ì½”ë“œ","ë¹„ì¤‘","ë°°ë¶„(ë§Œ)","ë°°ë‹¹ë¥ ","ì£¼ê¸°","í˜„ì¬ê°€(ì›)","ë§¤ìˆ˜(ì£¼)","íˆ¬ìì•¡","ì—°ë°°ë‹¹"].map((h,i)=><th key={i} className="px-2 py-2 text-center" style={{fontSize:9,fontWeight:700}}>{h}</th>)}</tr></thead><tbody>{alloc.map((a,i)=>(<tr key={i} style={{background:i%2?"#f8fafc":"#fff",borderBottom:"1px solid #f1f5f9"}}><td className="px-1 py-2 text-center text-gray-400" style={{fontSize:10}}>{i+1}</td><td className="px-2 py-2" style={{fontSize:10,fontWeight:700}}>{a.n}</td><td className="px-1 py-2 text-center" style={{fontSize:9,fontFamily:"monospace",color:"#9ca3af"}}>{a.c}</td><td className="px-1 py-2 text-center"><span className="px-2 py-0.5 rounded-full bg-blue-100 text-blue-800" style={{fontSize:12,fontWeight:800}}>{a.w}%</span></td><td className="px-2 py-2 text-right" style={{fontSize:15,fontWeight:700}}>{fw(a.amt)}</td><td className="px-2 py-2 text-center" style={{fontSize:14,fontWeight:800,color:"#059669"}}>{a.d}%</td><td className="px-1 py-2 text-center" style={{fontSize:10}}>{a.cy}</td><td className="px-1 py-2"><input type="number" value={prices[a.c]} onChange={e=>setPrices(p=>({...p,[a.c]:+e.target.value}))} className="w-full px-2 py-1 rounded outline-none" style={{border:"2px solid #fbbf24",background:"#fefce8",textAlign:"right",fontSize:14,fontWeight:800,color:"#1e40af"}}/></td><td className="px-2 py-2 text-center" style={{fontSize:22,fontWeight:900,color:"#1e40af"}}>{fw(a.sh)}</td><td className="px-2 py-2 text-right" style={{fontSize:13,fontWeight:600}}>{fw(a.act)}</td><td className="px-2 py-2 text-right" style={{fontSize:15,fontWeight:700,color:"#059669"}}>{fw(a.adv)}</td></tr>))}</tbody></table></div></div>);}

/* â•â•â• TAB 3 â•â•â• */
function Tab3(){const [total,setTotal]=useState(89100);const [rate,setRate]=useState(5.5);const [divRate,setDivRate]=useState(4.5);const [taxRate,setTaxRate]=useState(15.4);const [m61,setM61]=useState(200);const [m90,setM90]=useState(200);
  const autoM65=useMemo(()=>findOptimalM65(total,rate,divRate,taxRate,m61,m90),[total,rate,divRate,taxRate,m61,m90]);
  const rows=useMemo(()=>calcSchedule(total,rate,divRate,taxRate,m61,autoM65,m90),[total,rate,divRate,taxRate,m61,autoM65,m90]);const st=useMemo(()=>getStats(rows),[rows]);
  return(<div className="flex flex-col gap-3">
    <div className="grid grid-cols-7 gap-2"><NI label="ì´ìì‚°(ë§Œ)" value={total} onChange={setTotal}/><NI label="ìˆ˜ìµë¥ (%)" value={rate} onChange={setRate}/><NI label="ë°°ë‹¹ë¥ (%)" value={divRate} onChange={setDivRate}/><NI label="ì„¸ìœ¨(%)" value={taxRate} onChange={setTaxRate}/><NI label="61-64(ë§Œ)" value={m61} onChange={setM61}/><div className="p-2 rounded-lg text-center" style={{background:"#fef3c7"}}><div style={{fontSize:9,color:"#92400e",fontWeight:600}}>65ì„¸(ìë™)</div><div style={{fontSize:24,fontWeight:900,color:"#d97706"}}>{fw(autoM65)}</div></div><NI label="90-100(ë§Œ)" value={m90} onChange={setM90}/></div>
    <div className="grid grid-cols-4 gap-3"><Stat label="100ì„¸ì”ì•¡" value={fw(st.last.eb)} unit={st.last.eb<=500?"âœ… ìˆ˜ë ´":"ì”ì—¬"} color={st.last.eb<=500?"#059669":"#d97706"} big/><Stat label="ì›”í‰ê· " value={fw(st.avgM)} unit="ë§Œì›/ì›”" color="#1e40af" big/><Stat label="ì´ì¸ì¶œ" value={f(st.totalW)} unit="ì›" color="#1e40af"/><Stat label="ì´ìˆ˜ìµ" value={f(st.totalR)} unit="ì›" color="#059669"/></div>
    <BalChart rows={rows} depAge={st.depAge} uid="t3"/><CfTable rows={rows} hBg="#92400e" maxH={360}/></div>);}

/* â•â•â• TAB 4 â•â•â• */
function Tab4(){const [amounts,setAmounts]=useState(BK.map(b=>b.amt));const [prices,setPrices]=useState(Object.fromEntries(PORT.map(p=>[p.c,p.p])));
  return(<div className="flex flex-col gap-3">
    <div className="grid grid-cols-3 gap-3 p-3 rounded-xl" style={{background:"linear-gradient(135deg,#ede9fe,#f5f3ff)"}}>{BK.map((b,i)=><div key={i}><div style={{fontSize:10,fontWeight:700,color:"#6d28d9"}}>{b.name}</div><NI label={b.per} value={amounts[i]} onChange={v=>{const a=[...amounts];a[i]=v;setAmounts(a);}} suffix="ë§Œì›"/></div>)}</div>
    <Stat label="3ì‚¬ í•©ê³„" value={fw(amounts.reduce((s,a)=>s+a,0))} unit={f(amounts.reduce((s,a)=>s+a,0))+"ì›"} color="#6d28d9" big/>
    {BK.map((b,bi)=>{const bAmt=amounts[bi];return(<div key={bi} className="rounded-xl overflow-hidden" style={{border:"1px solid #e5e7eb"}}><div style={{padding:"8px 12px",background:"#4c1d95",color:"#fff",fontSize:11,fontWeight:700}}>{b.name} â€” {fw(bAmt)}ë§Œì›</div><table className="w-full" style={{fontSize:10}}><thead><tr style={{background:"#f5f3ff"}}>{["ì¢…ëª©ëª…","ì½”ë“œ","ë¹„ì¤‘","ë°°ë¶„(ë§Œ)","í˜„ì¬ê°€","ë§¤ìˆ˜(ì£¼)"].map((h,i)=><th key={i} className="px-2 py-1.5 text-center" style={{fontSize:9,fontWeight:700,color:"#6d28d9"}}>{h}</th>)}</tr></thead><tbody>{PORT.map((p,pi)=>{const al=Math.round(bAmt*p.w/100),sh=Math.floor(al*10000/prices[p.c]);return(<tr key={pi} style={{background:pi%2?"#faf5ff":"#fff",borderBottom:"1px solid #f1f5f9"}}><td className="px-2 py-1" style={{fontSize:9,fontWeight:600}}>{p.n}</td><td className="px-1 py-1 text-center" style={{fontSize:8,fontFamily:"monospace",color:"#9ca3af"}}>{p.c}</td><td className="px-1 py-1 text-center" style={{fontSize:12,fontWeight:800}}>{p.w}%</td><td className="px-2 py-1 text-right" style={{fontSize:14,fontWeight:700}}>{fw(al)}</td><td className="px-1 py-1"><input type="number" value={prices[p.c]} onChange={e=>setPrices(ps=>({...ps,[p.c]:+e.target.value}))} className="w-full px-1 py-0.5 rounded outline-none" style={{border:"1px solid #fbbf24",background:"#fefce8",textAlign:"right",fontSize:11,fontWeight:700,color:"#1e40af"}}/></td><td className="px-2 py-1 text-center" style={{fontSize:18,fontWeight:900,color:"#4c1d95"}}>{fw(sh)}</td></tr>);})}</tbody></table></div>);})}</div>);}

/* â•â•â• TAB 5 â•â•â• */
function Tab5(){const M61=100,M90=100;const [total,setTotal]=useState(50000);const [rate,setRate]=useState(5.5);const [divRate,setDivRate]=useState(4.5);const [taxRate,setTaxRate]=useState(15.4);const [prices,setPrices]=useState(Object.fromEntries(PORT.map(p=>[p.c,p.p])));
  const autoM65=useMemo(()=>findOptimalM65(total,rate,divRate,taxRate,M61,M90),[total,rate,divRate,taxRate]);
  const alloc=useMemo(()=>PORT.map(p=>{const amt=Math.round(total*p.w/100),sh=Math.floor(amt*10000/prices[p.c]),act=Math.round(sh*prices[p.c]/10000);return{...p,amt,sh,act,adv:Math.round(act*p.d/100)};}),[total,prices]);const totAdv=alloc.reduce((s,a)=>s+a.adv,0);
  const rows=useMemo(()=>calcSchedule(total,rate,divRate,taxRate,M61,autoM65,M90),[total,rate,divRate,taxRate,autoM65]);const st=useMemo(()=>getStats(rows),[rows]);
  return(<div className="flex flex-col gap-3">
    <div className="p-4 rounded-xl" style={{background:"linear-gradient(135deg,#065f46,#059669)"}}><div style={{fontSize:14,fontWeight:900,color:"#fff"}}>ğŸ’¼ ë²”ìš© IRP ì—°ê¸ˆ ì»¨ì„¤íŒ…</div><div style={{fontSize:10,color:"#a7f3d0"}}>61-64ì„¸ 100ë§Œ/90-100ì„¸ 100ë§Œ ê³ ì •, 65ì„¸ ìµœëŒ€ ìë™ê³„ì‚°</div></div>
    <div className="grid grid-cols-4 gap-3"><NI label="IRP ì´ê¸ˆì•¡(ë§Œ)" value={total} onChange={setTotal} note={f(total)+"ì›"}/><NI label="ìˆ˜ìµë¥ (%)" value={rate} onChange={setRate}/><NI label="ë°°ë‹¹ë¥ (%)" value={divRate} onChange={setDivRate}/><NI label="ì„¸ìœ¨(%)" value={taxRate} onChange={setTaxRate}/></div>
    <div className="grid grid-cols-3 gap-4 p-3 rounded-xl" style={{background:"#fef3c7",border:"2px solid #f59e0b"}}>
      <div className="text-center"><div style={{fontSize:10,color:"#6b7280"}}>61-64ì„¸</div><div style={{fontSize:24,fontWeight:900,color:"#3b82f6"}}>{fw(M61)}ë§Œ</div></div>
      <div className="text-center p-2 rounded-xl bg-white" style={{border:"2px solid #f59e0b"}}><div style={{fontSize:10,color:"#d97706",fontWeight:700}}>65ì„¸ ìµœëŒ€(ìë™)</div><div style={{fontSize:32,fontWeight:900,color:"#d97706"}}>{fw(autoM65)}ë§Œ</div></div>
      <div className="text-center"><div style={{fontSize:10,color:"#6b7280"}}>90-100ì„¸</div><div style={{fontSize:24,fontWeight:900,color:"#6b7280"}}>{fw(M90)}ë§Œ</div></div></div>
    <div className="grid grid-cols-5 gap-3"><Stat label="ì›”í‰ê· " value={fw(st.avgM)} unit="ë§Œì›/ì›”" color="#1e40af" big/><Stat label="ì´ì¸ì¶œ" value={f(st.totalW)} unit="ì›" color="#1e40af"/><Stat label="ì´ìˆ˜ìµ" value={f(st.totalR)} unit="ì›" color="#059669"/><Stat label="100ì„¸ì”ì•¡" value={fw(st.last.eb)} unit="âœ… ìˆ˜ë ´" color="#059669" big/><Stat label="ì›”ë°°ë‹¹" value={fw(Math.round(totAdv/12))} unit="ë§Œ/ì›”" color="#0d9488"/></div>
    <BalChart rows={rows} depAge={st.depAge} uid="t5"/>
    <div className="overflow-auto rounded-xl" style={{border:"1px solid #e5e7eb"}}><table className="w-full" style={{fontSize:10}}><thead><tr style={{background:"#065f46",color:"#fff"}}>{["ì¢…ëª©ëª…","ì½”ë“œ","ë¹„ì¤‘","ë°°ë¶„(ë§Œ)","ë°°ë‹¹ë¥ ","í˜„ì¬ê°€","ë§¤ìˆ˜(ì£¼)","íˆ¬ìì•¡","ì—°ë°°ë‹¹"].map((h,i)=><th key={i} className="px-2 py-2 text-center" style={{fontSize:9,fontWeight:700}}>{h}</th>)}</tr></thead><tbody>{alloc.map((a,i)=>(<tr key={i} style={{background:i%2?"#f0fdf4":"#fff",borderBottom:"1px solid #f1f5f9"}}><td className="px-2 py-1" style={{fontSize:9,fontWeight:700}}>{a.n}</td><td className="px-1 py-1 text-center" style={{fontSize:8,fontFamily:"monospace",color:"#9ca3af"}}>{a.c}</td><td className="px-1 py-1 text-center"><span className="px-1.5 py-0.5 rounded-full bg-emerald-100 text-emerald-800" style={{fontSize:11,fontWeight:800}}>{a.w}%</span></td><td className="px-2 py-1 text-right" style={{fontSize:14,fontWeight:700}}>{fw(a.amt)}</td><td className="px-1 py-1 text-center" style={{fontSize:13,fontWeight:800,color:"#059669"}}>{a.d}%</td><td className="px-1 py-1"><input type="number" value={prices[a.c]} onChange={e=>setPrices(p=>({...p,[a.c]:+e.target.value}))} className="w-full px-1 py-0.5 rounded outline-none" style={{border:"2px solid #fbbf24",background:"#fefce8",textAlign:"right",fontSize:12,fontWeight:800,color:"#1e40af"}}/></td><td className="px-2 py-1 text-center" style={{fontSize:20,fontWeight:900,color:"#065f46"}}>{fw(a.sh)}</td><td className="px-2 py-1 text-right" style={{fontSize:12,fontWeight:600}}>{fw(a.act)}</td><td className="px-2 py-1 text-right" style={{fontSize:14,fontWeight:700,color:"#059669"}}>{fw(a.adv)}</td></tr>))}</tbody></table></div>
    <CfTable rows={rows} hBg="#065f46"/></div>);}

/* â•â•â• TAB 6: ë°°ë‹¹ ë‚´ì—­ (ì¢…ëª©ë³„ + ì›”ë³„ê·¸ë¦¬ë“œ + ì°¨íŠ¸ + 10ë…„ì¶”ì´) â•â•â• */
function Tab6(){const [total,setTotal]=useState(89100);const [taxRate,setTaxRate]=useState(15.4);const [growthRate,setGrowthRate]=useState(2.0);const [prices,setPrices]=useState(Object.fromEntries(PORT.map(p=>[p.c,p.p])));
  const data=useMemo(()=>PORT.map(p=>{const amt=Math.round(total*p.w/100),sh=Math.floor(amt*10000/prices[p.c]),act=Math.round(sh*prices[p.c]/10000),pre=Math.round(act*p.d/100),tax=Math.round(pre*taxRate/100),post=pre-tax,np=p.mo.length||1,pp=p.d>0?Math.round(post/np):0;return{...p,act,pre,tax,post,monthly:Array.from({length:12},(_,m)=>p.mo.includes(m+1)&&p.d>0?pp:0)};}),[total,taxRate,prices]);
  const mt=Array.from({length:12},(_,m)=>data.reduce((s,d)=>s+d.monthly[m],0)),yt=data.reduce((s,d)=>s+d.post,0),mx=Math.max(...mt),mn=Math.min(...mt);
  const yd=Array.from({length:10},(_,y)=>{const fc=Math.pow(1+growthRate/100,y),st=data.map(d=>Math.round(d.post*fc));return{year:2027+y,total:st.reduce((s,v)=>s+v,0),st};});
  return(<div className="flex flex-col gap-3">
    <div className="grid grid-cols-3 gap-3"><NI label="IRP ì´ê¸ˆì•¡(ë§Œ)" value={total} onChange={setTotal} note={f(total)+"ì›"}/><NI label="ë°°ë‹¹ì„¸ìœ¨(%)" value={taxRate} onChange={setTaxRate}/><NI label="ë°°ë‹¹ì„±ì¥ë¥ (%)" value={growthRate} onChange={setGrowthRate} note="ì—°í‰ê· ì„±ì¥"/></div>
    <div className="grid grid-cols-4 gap-3"><Stat label="ì—°ê°„ë°°ë‹¹(ì„¸í›„)" value={fw(yt)} unit="ë§Œì›/ë…„" color="#0d9488" big/><Stat label="ì›”í‰ê· " value={fw(Math.round(yt/12))} unit="ë§Œì›/ì›”" color="#0d9488" big/><Stat label="ìµœëŒ€ì›”" value={fw(mx)} unit="ë§Œì›" color="#059669"/><Stat label="ìµœì†Œì›”" value={fw(mn)} unit="ë§Œì›" color="#d97706"/></div>
    {/* ì¢…ëª©ë³„ ìƒì„¸ */}
    <div className="rounded-xl overflow-hidden" style={{border:"1px solid #e5e7eb"}}><div style={{padding:"8px 12px",background:"#134e4a",color:"#fff",fontSize:11,fontWeight:700}}>ì¢…ëª©ë³„ ë°°ë‹¹ ìƒì„¸</div><table className="w-full" style={{fontSize:10}}><thead><tr style={{background:"#f0fdfa"}}>{["#","ì¢…ëª©ëª…","íˆ¬ìì•¡(ë§Œ)","ë°°ë‹¹ë¥ ","ì£¼ê¸°","ì„¸ì „(ë§Œ)","ì„¸ê¸ˆ","ì„¸í›„(ë§Œ)","ì›”í™˜ì‚°"].map((h,i)=><th key={i} className="px-2 py-2 text-center" style={{fontSize:9,fontWeight:700,color:"#134e4a"}}>{h}</th>)}</tr></thead><tbody>{data.map((d,i)=>(<tr key={i} style={{background:i%2?"#f0fdfa":"#fff",borderBottom:"1px solid #f1f5f9"}}><td className="p-1 text-center text-gray-400" style={{fontSize:9}}>{i+1}</td><td className="px-2 py-1" style={{fontSize:10,fontWeight:700}}>{d.n}</td><td className="px-2 py-1 text-right" style={{fontSize:14,fontWeight:700}}>{fw(d.act)}</td><td className="p-1 text-center" style={{fontSize:14,fontWeight:800,color:"#0d9488"}}>{d.d}%</td><td className="p-1 text-center" style={{fontSize:10}}>{d.cy}</td><td className="px-2 py-1 text-right" style={{fontSize:13,fontWeight:600}}>{fw(d.pre)}</td><td className="px-2 py-1 text-right" style={{fontSize:12,fontWeight:600,color:"#dc2626"}}>-{fw(d.tax)}</td><td className="px-2 py-1 text-right" style={{fontSize:16,fontWeight:900,color:"#0d9488"}}>{fw(d.post)}</td><td className="px-2 py-1 text-right" style={{fontSize:15,fontWeight:800,color:"#1e40af"}}>{fw(Math.round(d.post/12))}</td></tr>))}</tbody></table></div>
    {/* ì›”ë³„ ì°¨íŠ¸ */}
    <div className="rounded-xl bg-white p-4 shadow" style={{border:"1px solid #e5e7eb"}}><div style={{fontSize:10,fontWeight:700,color:"#1e40af",marginBottom:8}}>ì›”ë³„ ë°°ë‹¹ ìˆ˜ë ¹ì•¡ (ì„¸í›„)</div><div className="flex items-end" style={{gap:6,height:120}}>{mt.map((v,m)=>{const h=mx>0?(v/mx)*100:0;return(<div key={m} style={{flex:1,display:"flex",flexDirection:"column",alignItems:"center",gap:4}}><div style={{fontSize:12,fontWeight:800,color:"#0d9488"}}>{fw(v)}</div><div style={{width:"100%",height:h,borderRadius:"6px 6px 0 0",background:v===mx?"#0d9488":v===mn?"#fbbf24":"#6ee7b7"}}/><div style={{fontSize:9,color:"#6b7280",fontWeight:600}}>{MN[m]}</div></div>);})}</div></div>
    {/* ì›”ë³„ ê·¸ë¦¬ë“œ í…Œì´ë¸” */}
    <div className="overflow-x-auto rounded-xl" style={{border:"1px solid #e5e7eb"}}><div style={{padding:"8px 12px",background:"#1e40af",color:"#fff",fontSize:11,fontWeight:700}}>ì›”ë°°ë‹¹ê¸ˆ ë³€ë™í‘œ</div><table className="w-full" style={{fontSize:10,minWidth:900}}><thead><tr style={{background:"#eff6ff"}}><th style={{padding:8,textAlign:"left",fontSize:9,fontWeight:700,color:"#1e40af",minWidth:140}}>ì¢…ëª©ëª…</th><th className="p-2 text-center" style={{fontSize:9,fontWeight:700,color:"#1e40af"}}>ì£¼ê¸°</th>{MN.map((m,i)=><th key={i} className="p-2 text-center" style={{fontSize:9,fontWeight:700,color:"#1e40af",minWidth:48}}>{m}</th>)}<th className="p-2 text-center" style={{fontSize:9,fontWeight:700,color:"#1e40af"}}>ì—°í•©ê³„</th></tr></thead><tbody>{data.map((d,i)=>(<tr key={i} style={{background:i%2?"#f8fafc":"#fff",borderBottom:"1px solid #f1f5f9"}}><td className="p-1 px-2" style={{fontSize:9,fontWeight:700}}>{d.n}</td><td className="p-1 text-center" style={{fontSize:9}}>{d.cy}</td>{d.monthly.map((v,m)=>(<td key={m} className="p-1 text-center" style={{fontSize:v>0?16:10,fontWeight:v>0?900:400,color:v>0?"#0d9488":"#e5e7eb",background:v>0?"#d1fae5":"transparent"}}>{v>0?fw(v):"-"}</td>))}<td className="p-1 px-2 text-center" style={{fontSize:14,fontWeight:800}}>{fw(d.post)}</td></tr>))}</tbody><tfoot><tr style={{background:"#1e40af",color:"#fff"}}><td style={{padding:8,fontSize:10,fontWeight:700}}>ì›” í•©ê³„</td><td/>{mt.map((v,m)=>(<td key={m} className="p-2 text-center" style={{fontSize:18,fontWeight:900}}>{fw(v)}</td>))}<td className="p-2 text-center" style={{fontSize:16,fontWeight:900}}>{fw(yt)}</td></tr></tfoot></table></div>
    {/* 10ë…„ ë°°ë‹¹ ì¶”ì´ */}
    <div className="overflow-x-auto rounded-xl" style={{border:"1px solid #e5e7eb"}}><div style={{padding:"8px 12px",background:"#92400e",color:"#fff",fontSize:11,fontWeight:700}}>10ë…„ ë°°ë‹¹ ì¶”ì´ (ì„±ì¥ë¥  {growthRate}%)</div><table className="w-full" style={{fontSize:10}}><thead><tr style={{background:"#fffbeb"}}><th style={{padding:8,textAlign:"left",fontSize:9,fontWeight:700,color:"#92400e",minWidth:130}}>ì¢…ëª©</th>{yd.map((y,i)=><th key={i} className="p-2 text-center" style={{fontSize:9,fontWeight:700,color:"#92400e"}}>{y.year}</th>)}<th className="p-2 text-center" style={{fontSize:9,fontWeight:700,color:"#92400e"}}>10ë…„í•©</th></tr></thead><tbody>{data.map((d,di)=>(<tr key={di} style={{background:di%2?"#fffbeb":"#fff",borderBottom:"1px solid #f1f5f9"}}><td className="py-1 px-2" style={{fontSize:9,fontWeight:700}}>{d.n}</td>{yd.map((y,yi)=>(<td key={yi} className="p-1 text-center" style={{fontSize:d.d>0?13:10,fontWeight:d.d>0?700:400,color:d.d>0?"#92400e":"#d1d5db"}}>{d.d>0?fw(y.st[di]):"-"}</td>))}<td className="py-1 px-2 text-center" style={{fontSize:13,fontWeight:800}}>{fw(yd.reduce((s,y)=>s+y.st[di],0))}</td></tr>))}</tbody><tfoot><tr style={{background:"#92400e",color:"#fff"}}><td style={{padding:8,fontSize:10,fontWeight:700}}>ì—°í•©ê³„</td>{yd.map((y,i)=><td key={i} className="p-2 text-center" style={{fontSize:16,fontWeight:900}}>{fw(y.total)}</td>)}<td className="p-2 text-center" style={{fontSize:16,fontWeight:900}}>{fw(yd.reduce((s,y)=>s+y.total,0))}</td></tr><tr style={{background:"#fef3c7"}}><td style={{padding:6,fontSize:10,fontWeight:700,color:"#92400e"}}>ì›”í™˜ì‚°</td>{yd.map((y,i)=><td key={i} className="p-1 text-center" style={{fontSize:15,fontWeight:800,color:"#1e40af"}}>{fw(Math.round(y.total/12))}</td>)}<td className="p-1 text-center" style={{fontSize:14,fontWeight:800,color:"#1e40af"}}>{fw(Math.round(yd.reduce((s,y)=>s+y.total,0)/120))}</td></tr></tfoot></table></div>
  </div>);}

/* â•â•â• MAIN â•â•â• */
const TABS=[{id:"t1",label:"ì¸ì¶œ ì‹œë®¬ë ˆì´í„°",icon:"ğŸ“Š",color:"#1e40af"},{id:"t2",label:"í¬íŠ¸í´ë¦¬ì˜¤ ë§¤ìˆ˜",icon:"ğŸ’¹",color:"#065f46"},{id:"t3",label:"100ì„¸ í˜„ê¸ˆíë¦„",icon:"ğŸ“ˆ",color:"#92400e"},{id:"t4",label:"ì¦ê¶Œì‚¬ ë°°ë¶„",icon:"ğŸ¦",color:"#4c1d95"},{id:"t5",label:"ë²”ìš© ì»¨ì„¤íŒ…",icon:"ğŸ’¼",color:"#059669"},{id:"t6",label:"ë°°ë‹¹ ë‚´ì—­",icon:"ğŸ’°",color:"#0d9488"}];

export default function App(){const [tab,setTab]=useState("t1");
  return(<div className="min-h-screen" style={{background:"#f1f5f9"}}><div className="px-4 py-3" style={{background:"linear-gradient(135deg,#1e293b,#0f172a)"}}><div style={{maxWidth:1200,margin:"0 auto"}} className="flex items-center gap-3"><div className="flex items-center justify-center rounded-xl" style={{width:40,height:40,background:"linear-gradient(135deg,#3b82f6,#6366f1)",fontSize:18,fontWeight:900,color:"#fff"}}>â‚©</div><div><div style={{fontSize:16,fontWeight:900,color:"#fff"}}>100ì„¸ ì—°ê¸ˆ ì¸ì¶œ ì‹œë®¬ë ˆì´í„°</div><div style={{fontSize:9,color:"#94a3b8"}}>IRP í¬íŠ¸í´ë¦¬ì˜¤ & í˜„ê¸ˆíë¦„ ì»¨ì„¤íŒ… Â· ìœ ì•¤ê¹€ íŒ¨ë°€ë¦¬ì˜¤í”¼ìŠ¤</div></div></div></div>
    <div style={{maxWidth:1200,margin:"0 auto",padding:"0 16px"}}><div className="flex gap-1 pt-3 pb-2 overflow-x-auto">{TABS.map(t=>(<button key={t.id} onClick={()=>setTab(t.id)} className="flex items-center gap-1 px-3 py-2 rounded-xl whitespace-nowrap" style={{background:tab===t.id?t.color:"#fff",color:tab===t.id?"#fff":t.color,fontSize:12,fontWeight:800,boxShadow:tab===t.id?`0 4px 12px ${t.color}44`:"0 1px 3px #0001",border:tab===t.id?"none":`2px solid ${t.color}22`,cursor:"pointer"}}><span style={{fontSize:14}}>{t.icon}</span>{t.label}</button>))}</div>
      <div className="pb-6">{tab==="t1"&&<Tab1/>}{tab==="t2"&&<Tab2/>}{tab==="t3"&&<Tab3/>}{tab==="t4"&&<Tab4/>}{tab==="t5"&&<Tab5/>}{tab==="t6"&&<Tab6/>}</div></div>
    <div className="text-center py-4" style={{fontSize:10,color:"#94a3b8"}}>Â© 2027 ìœ ì•¤ê¹€ íŒ¨ë°€ë¦¬ì˜¤í”¼ìŠ¤ Â· IRP 100ì„¸ ì—°ê¸ˆ ì‹œë®¬ë ˆì´í„° v3.0</div></div>);}
